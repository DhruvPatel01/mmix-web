<!doctype html>

<head>
  <meta charset=utf8>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/style.css">
</head>

<body>

  <div id="main">
    <div id="left" class="split">
      <div class="header">
        <h1>MMIX Debugger</h1>
        <button id="show-load-github-btn">Load from GitHub</button>
        <button id="compile-btn">Compile</button>
        <button id="step-btn">Step</button>
        <button id="continue-btn">Continue</button>
      </div>
      <dialog id="load-github-dialog">
        <input type="text" id="github-url"
          value="https://raw.githubusercontent.com/theartofcomputerprogramming/mmixsamples/refs/heads/main/loadstore.mms"
          placeholder="Enter GitHub URL" />
        <button id="load-github-btn">Load</button>
        <div id="github-error-box">

        </div>
        <div>
          Sample codes from <a
            href="https://github.com/theartofcomputerprogramming/mmixsamples/tree/main">mmixsamples</a> github
          repository (Credit: <a href="https://github.com/zmajeed">Zartaj Majeed):
            <ul id="github-sample-list">
              <li><a
                  href="https://github.com/theartofcomputerprogramming/mmixsamples/blob/main/loadstore.mms">loadstore.mms</a>
                - examples of load and store instructions - to aid section Loading and
                storing in 1.3.1', Description of MMIX, from Chapter 1, Basic Concepts, of Fascicle 1, MMIX, by Donald
                Knuth
              <li><a
                  href="https://github.com/theartofcomputerprogramming/mmixsamples/blob/main/arithmetic.mms">arithmetic.mms</a>
                - examples of arithmetic operators - to aid section Arithmetic operators
                in 1.3.1', Description of MMIX, from Chapter 1, Basic Concepts, of Fascicle 1, MMIX, by Donald Knuth
              </li>
              <li><a
                  href="https://github.com/theartofcomputerprogramming/mmixsamples/blob/main/conditional.mms">conditional.mms</a>
                - examples of conditional instructions - to aid section Conditional
                instructions in 1.3.1', Description of MMIX, from Chapter 1, Basic Concepts, of Fascicle 1, MMIX, by
                Donald Knuth</li>
              <li><a
                  href="https://github.com/theartofcomputerprogramming/mmixsamples/blob/main/subroutine.mms">subroutine.mms</a>
                - examples of subroutine calls - to aid section Subroutine calls in
                1.3.1', Description of MMIX, from Chapter 1, Basic Concepts, of Fascicle 1, MMIX, by Donald Knuth</li>
            </ul>
            <script>
              document.getElementById('github-sample-list').addEventListener('click', function (event) {
                const target = event.target;
                if (target.tagName.toLowerCase() === 'a') {
                  event.preventDefault();

                  const hrefValue = target.getAttribute('href');
                  document.getElementById('github-url').value = hrefValue;
                  document.getElementById('load-github-btn').click();
                }
              });

            </script>

        </div>
      </dialog>
      <div id="editor">
        <div id="editor-div"></div>
      </div>
      <div id="terminal">
        <textarea disabled id="the-terminal" placeholder="Terminal output..."></textarea>
      </div>
    </div>
    <div id="right" class="split">
      <div id="register-viewer">
        <h3>Register Viewer</h3>
        <select id="register-format">
          <option value="#">Hexadecimal</option>
          <option value="!">Decimal</option>
        </select>
        <div>
          <input type="text" id="add-register" placeholder="rA" />
          <button id="add-register-btn">Add Register</button>
        </div>
        <div id="register-window">
          <table id="register-table">
            <thead>
              <tr>
                <th>Register</th>
                <th>Value</th>
              </tr>
            </thead>
            <tbody>

            </tbody>
          </table>
        </div>
        <script>
          // Following code generates register table using javascript.
          // I have considered just manually creating the table. But, I like this approach better.
          // we are anyways using javascript for other things.
          // see code in justfile to generate the table using Python.

          function hideRow(button) {
            const row = button.closest("tr");
            row.classList.add("hidden-reg")
          }

          (function () {

            let make_table = function (id) {
              let table = document.getElementById(id);
              let tbody = table.getElementsByTagName('tbody')[0];
              return tbody;
            }

            let append_reg = function (tbody, reg_id) {
              const elem = `<tr  class="hidden-reg" id="regr${reg_id}"><td>r${reg_id}</td><td>0</td><td><button class="contrast" onclick="hideRow(this)">x</button></td></tr>`
              tbody.insertAdjacentHTML("beforeend", elem);
            }

            const tbody = make_table("register-table");


            for (let i = 0; i <= 255; i++) {
              append_reg(tbody, i);
            }

            for (let i = 65; i <= 90; i++) {
              append_reg(tbody, String.fromCharCode(i));
            }

            for (let reg of ['BB', 'TT', 'WW', 'XX', 'YY', 'ZZ']) {
              append_reg(tbody, reg);
            }

          })();
        </script>
      </div>
      <div id="memory-viewer">
        <h3>Memory</h3>
        <div>
          <select id="memory-address-cache">
            <option data-cacheHit=0 value="0">Text Segment</option>
            <option data-cacheHit=0 value="2000000000000000">Data Segment</option>
            <option data-cacheHit=0 value="4000000000000000">Pool Segment</option>
            <option data-cacheHit=0 value="6000000000000000">Stack Segment</option>
          </select>
        </div>
        <select id="memory-format">
          <option value="#">Hexadecimal</option>
          <option value="!">Unsigned Decimal</option>
          <option value="~">Signed Decimal</option>
        </select>
        <select id="memory-bytes">
          <option value="1">1 Byte</option>
          <option value="2">2 Bytes</option>
          <option value="4">4 Bytes</option>
          <option value="8">8 Bytes</option>
        </select>

        <div>
          <p>Use Hex notation without any prefix for address</p>
          <input type="text" id="memory-address-start" value="0" placeholder="Enter Starting Address (Hex)" />
          <input type="number" id="memory-address-count" value="128" placeholder="How many bytes to show" />
          <button id="load-memory-btn">Load Memory</button>
          <table>
            <thead>
              <tr>
                <th>Address</th>
                <th>Value</th>
              </tr>
              <tr>
                <td>

                </td>
              </tr>
            </thead>
            <tbody id="memory-table-body">

              <!-- Memory content will be populated here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/split.js/dist/split.min.js"></script>
  <script src="dist/editor.js" type="module"></script>
  <script>
    Split(['#left', '#right'], {
      sizes: [70, 30],
      minSize: 200,
      gutterSize: 8,
    });

    Split(['#editor', '#terminal'], {
      direction: 'vertical',
      sizes: [70, 30],
      minSize: 100,
      gutterSize: 8,
      elementStyle: (dimension, size, gutterSize) => ({
        'flex-basis': `calc(${size}% - ${gutterSize}px)`
      }),
      gutterStyle: (dimension, gutterSize) => ({
        'flex-basis': `${gutterSize}px`
      })
    });

    Split(['#register-viewer', '#memory-viewer'], {
      direction: 'vertical',
      sizes: [50, 50],
      minSize: 100,
      gutterSize: 8,
      elementStyle: (dimension, size, gutterSize) => ({
        'flex-basis': `calc(${size}% - ${gutterSize}px)`
      }),
      gutterStyle: (dimension, gutterSize) => ({
        'flex-basis': `${gutterSize}px`
      })
    });
  </script>
</body>